<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conjugation Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
        }
        .container {
            max-width: 800px;
            margin: auto;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        select {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.9em;
        }
        input[type="text"] {
            width: calc(100% - 60px);
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1.2em;
            box-sizing: border-box; /* Ensure padding is included in width calculation */
        }
        button {
            padding: 12px 24px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
        }
        button:hover {
            background-color: #0056b3;
        }
        #result {
            margin-top: 15px;
            font-size: 1.2em;
        }
        .controls {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .special-characters {
            margin: 10px 0;
            display: flex;
            justify-content: center;
            flex-wrap: nowrap;
            gap: 10px;
        }
        .special-characters button {
            padding: 8px 12px;
            font-size: 1.5em;
        }
        #word-info {
            margin-top: 15px;
            font-size: 1em;
            color: #555;
        }
        .word-navigation {
            margin-top: 10px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .word-navigation button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #007BFF;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }
        .word-navigation button:hover {
            background-color: #ddd;
        }

        .test-mode {
            border: 3px solid #f44336;
            background-color: #fff4f4;
        }
        .updated-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            font-size: 0.9em;
            color: #555;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 5px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Word Quiz</h1>
        <div class="controls">
            <label for="version-select">Version:</label>
            <select id="version-select" onchange="changeVersion()">
                <!-- Versions will be populated dynamically -->
            </select>

            <label for="chapter-select">Chapter:</label>
            <select id="chapter-select" onchange="changeChapter()">
                <!-- Chapters will be populated dynamically -->
            </select>
        </div>

        <div class="controls">
            <label>
                <input type="checkbox" id="random-toggle" onchange="toggleRandom()"> Random
            </label>
		<label>
    <input type="checkbox" id="diacritics-toggle" onchange="toggleDiacritics()"> Hide Diacritics
</label>

        </div>
        <p id="word-display"></p>
        <div class="special-characters" id="special-characters" style="display: none;">
            <button onclick="insertDiacritic('à')">à</button>
            <button onclick="insertDiacritic('â')">â</button>
            <button onclick="insertDiacritic('ç')">ç</button>
            <button onclick="insertDiacritic('é')">é</button>
            <button onclick="insertDiacritic('è')">è</button>
            <button onclick="insertDiacritic('ê')">ê</button>
            <button onclick="insertDiacritic('ë')">ë</button>
            <button onclick="insertDiacritic('î')">î</button>
            <button onclick="insertDiacritic('ï')">ï</button>
            <button onclick="insertDiacritic('ô')">ô</button>
            <button onclick="insertDiacritic('œ')">œ</button>
            <button onclick="insertDiacritic('ù')">ù</button>
            <button onclick="insertDiacritic('û')">û</button>
            <button onclick="insertDiacritic('ü')">ü</button>
        </div>
        <label for="je" style="display: inline-block; width: 40px;">Je/J':</label> 	<input type="text" id="answer1" placeholder="Type your answer here" onkeydown="handleKeyPress(event)">
	<label for="tu" style="display: inline-block; width: 40px;">Tu</label>		<input type="text" id="answer2" placeholder="Type your answer here" onkeydown="handleKeyPress(event)">
	<label for="il" style="display: inline-block; width: 40px;">Il/Elle/On:</label>	<input type="text" id="answer3" placeholder="Type your answer here" onkeydown="handleKeyPress(event)">
	<label for="nous" style="display: inline-block; width: 40px;">Nous:</label>	<input type="text" id="answer4" placeholder="Type your answer here" onkeydown="handleKeyPress(event)">
	<label for="vous" style="display: inline-block; width: 40px;">Vous:</label>	<input type="text" id="answer5" placeholder="Type your answer here" onkeydown="handleKeyPress(event)">
	<label for="ils" style="display: inline-block; width: 40px;">Ils/Elles:</label>	<input type="text" id="answer6" placeholder="Type your answer here" onkeydown="handleKeyPress(event)">
        <button data-action="toggle-answer" onclick="toggleAnswer()">Show Answer</button>
        <button onclick="checkAnswer()">Submit</button>
        <button id="test-mode-btn" onclick="startTestMode()">Test Mode</button>
        <p id="result"></p>
        <p id="word-info"></p>
        <div class="word-navigation">
	<button id="first-word-btn" onclick="gotoWord(0)"> << </button>
            <button id="prev-word-btn" onclick="navigateWord(-1)">← Previous</button>
            <button id="next-word-btn" onclick="navigateWord(1)">Next →</button>
		<button id="last-word-btn" onclick="gotoWord(currentWordList.length-1)"> >> </button>
        </div>
        <div class="updated-info">
            Last Updated: <span id="last-updated"></span>
        </div>
    </div>

    <script>
const wordLists = {
    
	french: { 1: [
		{word: "parler", definition: ["parle","parles","parle","parlons","parlez","parlent"]}
	]}
    
};

        let currentVersion = "french";
        let currentChapter = "all";
        let currentWordList = [];
        let currentIndex = 0;
        let isRandom = false;
        let testMode = false;
        let testWordOrder = [];
        let testIndex = 0;
	let wrongOnFirstTry = new Set(); // Tracks words answered wrong at least once
	let testAttempt = 1;


        function initialize() {
            currentWordList = getCombinedWordList();
            loadWord();
        }

        function getCombinedWordList() {
            return Object.values(wordLists[currentVersion]).flat();
        }




	    

        function loadWord() {

		// Determine the index to use
    if (isRandom) {
        currentIndex = Math.floor(Math.random() * currentWordList.length);
    }
            const item = currentWordList[currentIndex];
            const wordDisplay = document.getElementById("word-display");

            if (!item) {
                wordDisplay.innerText = "No words available.";
                return;
            }

            
                wordDisplay.innerText = `Infinitive: ${item.word}`;
		    

            document.getElementById("answer1").value = "";
		document.getElementById("answer2").value = "";
		document.getElementById("answer3").value = "";
		document.getElementById("answer4").value = "";
		document.getElementById("answer5").value = "";
		document.getElementById("answer6").value = "";

		document.getElementById("answer1").focus();

            document.getElementById("result").innerText = "";
		document.querySelector('button[data-action="toggle-answer"]').innerText = "Show Answer";
	document.getElementById("word-info").innerText = `Word ${currentIndex + 1}/${currentWordList.length}`; // Update progress
        }





	    

        function toggleAnswer() {

            const resultElement = document.getElementById("result");
            const toggleButton = document.querySelector('button[data-action="toggle-answer"]');
            const currentWord = testMode ? currentWordList[testWordOrder[testIndex]] : currentWordList[currentIndex];

            if (toggleButton.innerText === "Show Answer") {
                const correctAnswer = currentWord.definition.join("; ");
		    
                resultElement.innerText = `Answer: ${correctAnswer}`;
		    resultElement.style.color="black";
                toggleButton.innerText = "Hide Answer";
            } else {
                resultElement.innerText = "";
                toggleButton.innerText = "Show Answer";
            }
		
        }

	    // Function to populate the version dropdown dynamically
function populateVersionDropdown() {
    const versionSelect = document.getElementById("version-select");
    
    // Clear any existing options
    versionSelect.innerHTML = "";
    
    // Populate version dropdown dynamically based on wordLists
    Object.keys(wordLists).forEach(version => {
        const option = document.createElement('option');
        option.value = version;
        option.textContent = version.charAt(0).toUpperCase() + version.slice(1);
        versionSelect.appendChild(option);
    });

    // Set default version to first one in the list
    const defaultVersion = Object.keys(wordLists)[0];
    versionSelect.value = defaultVersion;

    // Update the chapter dropdown based on the default version
    currentVersion = defaultVersion;  // Set the current version
    updateChapterDropdown();  // Update chapters for the selected version
    changeChapter();  // Load the first chapter or "all"
}

// Function to update the chapter dropdown dynamically based on selected version
function updateChapterDropdown() {
    const versionSelect = document.getElementById("version-select");
    const chapterSelect = document.getElementById("chapter-select");
    
    // Clear any existing options
    chapterSelect.innerHTML = "";

    const selectedVersion = versionSelect.value;

	 // Add "All" option for the user to select all chapters
    const allOption = document.createElement('option');
    allOption.value = "all";
    allOption.textContent = "All";
    chapterSelect.appendChild(allOption);

    // Populate chapter dropdown dynamically based on the selected version
    const chapters = Object.keys(wordLists[selectedVersion]);
    chapters.forEach(chapter => {
        const option = document.createElement('option');
        option.value = chapter;
        option.textContent = `${chapter}`;
        chapterSelect.appendChild(option);
    });

   

    // Set default chapter to the first one in the list
    chapterSelect.value = chapters[0];
}

function updateChapterDropdown() {
    const chapterSelect = document.getElementById("chapter-select");
    const selectedVersion = currentVersion; // Get selected version
    const versionWordList = wordLists[selectedVersion]; // Get word list for selected version

    // Get the chapter keys for the selected version
    const chapterKeys = Object.keys(versionWordList);
    
    // Clear current options
    chapterSelect.innerHTML = "";

    // Populate chapter dropdown dynamically
    chapterKeys.forEach(chapter => {
        const option = document.createElement('option');
        option.value = chapter;
        option.textContent = `Chapter ${chapter}`;
        chapterSelect.appendChild(option);
    });

    // Add "All" option to allow the user to select all chapters
    const allOption = document.createElement('option');
    allOption.value = "all";
    allOption.textContent = "All";
    chapterSelect.appendChild(allOption);

    // Set default chapter to the first available chapter
    chapterSelect.value = chapterKeys[0] || "all"; // Ensure "all" is selected if no chapters are available
}
	    
function changeVersion() {
    const versionSelect = document.getElementById("version-select");
    currentVersion = versionSelect.value; // Update currentVersion to the selected version

    // Update the chapter dropdown and load the word list for the selected version
    updateChapterDropdown();
    changeChapter();  // Update word list based on version and chapter
    updateSpecialCharacters();
}

// Function to update special characters visibility (for French mode)
function updateSpecialCharacters() {
    const specialCharsContainer = document.getElementById("special-characters");

    // Show special characters only if French version is selected
    if (currentVersion === "french") {
        specialCharsContainer.style.display = "flex"; // Show
    } else {
        specialCharsContainer.style.display = "none"; // Hide
    }
}



   function changeChapter() {
            const chapterSelect = document.getElementById("chapter-select");
            currentChapter = chapterSelect.value;

            if (currentChapter === "all") {
                currentWordList = getCombinedWordList();
            } else {
                currentWordList = wordLists[currentVersion][currentChapter];
            }

            currentIndex = 0;
            loadWord();
        }
       
// Initialize the dropdowns and set default values when the page loads
document.addEventListener("DOMContentLoaded", () => {
    populateVersionDropdown();  // Populate the version dropdown
});



function checkAnswer() {
    const userAnswer1 = document.getElementById("answer1").value.trim().toLowerCase();
	const userAnswer2 = document.getElementById("answer2").value.trim().toLowerCase();
	const userAnswer3 = document.getElementById("answer3").value.trim().toLowerCase();
	const userAnswer4 = document.getElementById("answer4").value.trim().toLowerCase();
	const userAnswer5 = document.getElementById("answer5").value.trim().toLowerCase();
	const userAnswer6 = document.getElementById("answer6").value.trim().toLowerCase();
    const currentWordIndex = testMode ? testIndex : currentIndex;
    const currentWord = testMode ? currentWordList[testWordOrder[testIndex]] : currentWordList[currentWordIndex];
    const correctAnswers = currentWord.definition.map(def => def.toLowerCase());
	const correctAnswer1=correctAnswers[0];
	const correctAnswer2=correctAnswers[1];
	const correctAnswer3=correctAnswers[2];
	const correctAnswer4=correctAnswers[3];
	const correctAnswer5=correctAnswers[4];
	const correctAnswer6=correctAnswers[5];

    const resultElement = document.getElementById("result");

    if ( (userAnswer1==correctAnswer1 && userAnswer2==correctAnswer2 && userAnswer3==correctAnswer3 && userAnswer4==correctAnswer4 && userAnswer5==correctAnswer5 && userAnswer6==correctAnswer6) || userAnswer1=="a") {
        resultElement.innerText = "Correct!";
        resultElement.style.color = "green";

        if (testMode) {
            testIndex++;
            setTimeout(() => loadTestWord(), 500);
        } else {
            currentIndex = (currentIndex + 1) % currentWordList.length;
            setTimeout(() => {
                resultElement.innerText = ""; // Clear result
                loadWord();
            }, 500);
        }
    } else {
        resultElement.innerText = "Wrong! Try again!";
        resultElement.style.color = "red";

        if (testMode) {
            wrongOnFirstTry.add(currentWordIndex); // Track as wrong
        }

        setTimeout(() => {
		document.querySelector('button[data-action="toggle-answer"]').innerText = "Show Answer";
            resultElement.innerText = ""; // Clear result
        }, 500);
    }
}

function gotoWord(coordinate){
	if (testMode) {
        alert("Navigation is not allowed in Test Mode.");
        return;
    }

	currentIndex=coordinate;

	// Stop if out of bounds
    if (currentIndex < 0) {
	    alert("Enter a valid coordinate!");
        currentIndex = 0;
    } else if (currentIndex >= currentWordList.length) {
	      alert("Enter a valid coordinate!");
        currentIndex = currentWordList.length-1;
    }

    loadWord();
}

function navigateWord(direction) {
    if (testMode) {
        alert("Navigation is not allowed in Test Mode.");
        return;
    }

    currentIndex += direction;

    // Stop if out of bounds
    if (currentIndex < 0) {
	    alert("This is the first word of the chapter!");
        currentIndex = 0;
    } else if (currentIndex >= currentWordList.length) {
	      alert("This is the last word of the chapter!");
        currentIndex = currentWordList.length-1;
    }

    loadWord();
}



        function toggleRandom() {
            isRandom = document.getElementById("random-toggle").checked;
            loadWord();
        }


        function handleKeyPress(event) {
            if (event.key === "Enter") {
                checkAnswer();
            }
        }

function startTestMode() {
    if (testMode) {
        endTestMode();
        return;
    }

   if (currentChapter === "all") {
        const currentWord = currentWordList[currentIndex];
        let foundChapter = null;

        // Determine which chapter the current word belongs to
        for (const [chapter, words] of Object.entries(wordLists[currentVersion])) {
            if (words.some(word => word.word === currentWord.word)) {
                foundChapter = chapter;
                break;
            }
        }

        if (foundChapter) {
            currentChapter = foundChapter;
            const chapterSelect = document.getElementById("chapter-select");
            chapterSelect.value = foundChapter; // Update the dropdown visually
            changeChapter(); // Update the word list to the selected chapter
        } else {
            alert("Unable to determine the chapter of the current word.");
            return;
        }
    }

    testMode = true;
    testWordOrder = shuffleArray([...Array(currentWordList.length).keys()]);
    testIndex = 0;
    wrongOnFirstTry.clear(); // Reset for the new test
testAttempt=1;


    const button = document.getElementById("test-mode-btn");
    button.innerText = "End Test Mode";
    button.style.backgroundColor = "#f44336";
    document.querySelector(".container").classList.add("test-mode");

	const randomCheckbox = document.getElementById("random-toggle");
    randomCheckbox.disabled = true; // Disable the random checkbox

    loadTestWord();
}



        function endTestMode() {
	
            testMode = false;
            const button = document.getElementById("test-mode-btn");
            button.innerText = "Test Mode";
		document.querySelector(".container").classList.remove("test-mode"); // Remove test-mode styling

	const randomCheckbox = document.getElementById("random-toggle");
    randomCheckbox.disabled = false; // Re-enable the checkbox

            loadWord();
        }

       


function loadTestWord() {
    if (testIndex >= testWordOrder.length) {
        if (wrongOnFirstTry.size > 0) {
            alert(`You had ${wrongOnFirstTry.size} wrong answers. Starting a new cycle.`);

            // Create a new order including incorrect answers
            let newCycleOrder = shuffleArray([...Array(currentWordList.length).keys()]);
            wrongOnFirstTry.forEach(wrongIndex => {
                if (wrongIndex >= 0 && wrongIndex < testWordOrder.length) {
                    newCycleOrder.push(testWordOrder[wrongIndex]); // Ensure valid indices
                } else {
                    console.error(`Invalid index in wrongOnFirstTry: ${wrongIndex}`);
                }
            });

		wrongOnFirstTry.clear();

            // Shuffle and reset
            if (newCycleOrder.length === 0) {
                console.error("Error: newCycleOrder is empty. Aborting new cycle.");
                return;
            }
            testWordOrder = shuffleArray(newCycleOrder.slice());
            console.log("New test cycle initiated:", testWordOrder, "Attempt:", testAttempt);

            testIndex = 0;
            testAttempt++;
            loadTestWord(); // Start new cycle
        } else {
            alert("Test complete! You answered all words correctly on the first try.");
            endTestMode();
        }

        return;
    }

    // Load the current test word
    const currentTestWord = currentWordList[testWordOrder[testIndex]];
    const wordDisplay = document.getElementById("word-display");

    
        wordDisplay.innerText = `Word: ${currentTestWord.word}`;
	   
    

    document.getElementById("answer1").value = "";
	document.getElementById("answer2").value = "";
	document.getElementById("answer3").value = "";
	document.getElementById("answer4").value = "";
	document.getElementById("answer5").value = "";
	document.getElementById("answer6").value = "";
	document.getElementById("answer1").focus();
	
    document.getElementById("result").innerText = "";
	document.querySelector('button[data-action="toggle-answer"]').innerText = "Show Answer";
    document.getElementById("word-info").innerText = `Test Attempt #${testAttempt} | Problem ${testIndex + 1}/${testWordOrder.length}`;

    const showAnswerButton = document.querySelector('button[data-action="toggle-answer"]');
}





document.getElementById("last-updated").innerText = "Version: 9 Jan 2025-11 by Wonhyuk Lee. mistercwon@gmail.com"; // Static date



function insertCharacter(character) {
    const answerField = document.activeElement;
    answerField.value += character;  // Append the character to the input field
    answerField.focus();  // Keep the focus on the input field
}

	    function toggleDiacritics() {
    const diacriticsCheckbox = document.getElementById("diacritics-toggle");
    const specialCharsContainer = document.getElementById("special-characters");

    if (diacriticsCheckbox.checked) {
        specialCharsContainer.style.display = "none"; // Hide diacritics
    } else {
        specialCharsContainer.style.display = "flex"; // Show diacritics
    }
}

function insertDiacritic(diacritic) {
    const inputElement = document.activeElement;
    
    // Get the current cursor position
    const start = inputElement.selectionStart;
    const end = inputElement.selectionEnd;
    const currentValue = inputElement.value;

    // Insert the diacritic at the cursor position
    inputElement.value = currentValue.slice(0, start) + diacritic + currentValue.slice(end);

    // Move the cursor to after the inserted character
    inputElement.selectionStart = inputElement.selectionEnd = start + diacritic.length;

    // Refocus on the input element
    inputElement.focus();
}


        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        initialize();
    </script>
</body>
</html>
